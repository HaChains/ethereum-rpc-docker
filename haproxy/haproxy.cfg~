global           
                                                   
        nbproc 1
        nbthread 2           
        cpu-map auto:1/1-2 0-1             
                                                                                                      
        log /dev/log    local0
        log /dev/log    local1 notice                                                                 
        #chroot /var/lib/haproxy                                                                      
        user haproxy                                                                                  
        group haproxy
        daemon   
        external-check
                                                   
defaults
    mode http                 
    log global                              
    option httplog                                                                                    
    option  http-keep-alive
    option  dontlognull                                                                               
    option  redispatch                                                                                
    option  contstats                                                                                 
    retries 3
    backlog 10000
    timeout client          50s
    timeout connect          5s
    timeout server          50s
    timeout tunnel        3600s
    timeout http-keep-alive  2s
    timeout http-request    15s
    timeout queue           30s
    timeout tarpit          60s
    default-server inter 3s rise 2 fall 3
    option forwardfor

        #
listen  stats
        bind *:9600
        stats enable
        stats uri /stats
        stats realm Haproxy\ Statistics
        stats auth pocket:P@ssw0rd00!

frontend eth-frontend
        bind 0.0.0.0:80
        acl network_allowed src 178.63.240.5/32 65.21.146.185/32 51.89.64.105/32 157.90.16.143/32 5.2.147.185/32 88.99.249.251/32 135.181.73.218/32 95.217.16.102/32 178.170.47.16/32 178.170.42.130/32 203.
86.232.156/32 49.12.165.122/32 162.55.165.32/32 148.251.194.119/32
        acl is_oe-lb-ext hdr(host) -i oe-lb-ext.easy2stake.com
        acl is_tg-lb-ext hdr(host) -i tg-lb-ext.easy2stake.com
        use_backend oe-nodes if is_oe-lb-ext network_allowed
        #use_backend tg-nodes if is_tg-lb-ext network_allowed
        default_backend backend-no-match

backend backend-no-match
        http-request deny deny_status 400


backend oe-nodes
        mode http
        balance roundrobin

        option external-check
        external-check path "/usr/bin:/bin"
        external-check command /var/lib/haproxy/eth-healthcheck.sh

        server 157.90.90.29 157.90.90.29:8545 check inter 10000 fall 3 rise 2 maxconn 2000
        server 162.55.4.245 162.55.4.245:8545 check inter 10000 fall 3 rise 2 maxconn 2000
        #server 65.21.76.113 65.21.76.113:8545 check inter 10000 fall 3 rise 2 maxconn 2000

#backend tg-nodes
#        mode http
#        balance roundrobin
#
#        option external-check
#        external-check path "/usr/bin:/bin"
#        external-check command /var/lib/haproxy/eth-healthcheck.sh
#
#        server 135.181.5.147 135.181.5.147:9656 check inter 10000 fall 3 rise 2 maxconn 2000
#        server 176.9.147.47 176.9.147.47:9656 check inter 10000 fall 3 rise 2 maxconn 2000
#        server 168.119.64.26 168.119.64.26:9656 check inter 10000 fall 3 rise 2 maxconn 2000